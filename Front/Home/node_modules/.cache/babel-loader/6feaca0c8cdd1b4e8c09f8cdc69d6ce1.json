{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs3/helpers/interopRequireDefault\");\n\nvar _Object$defineProperty2 = require(\"@babel/runtime-corejs3/core-js-stable/object/define-property\");\n\n_Object$defineProperty2(exports, \"__esModule\", {\n  value: true\n});\n\nexports.defaultState = defaultState;\nexports.setServerData = setServerData;\nexports.setPendingOp = setPendingOp;\nexports.pushPendingState = pushPendingState;\nexports.popPendingState = popPendingState;\nexports.mergeFirstPendingState = mergeFirstPendingState;\nexports.estimateAttribute = estimateAttribute;\nexports.estimateAttributes = estimateAttributes;\nexports.commitServerChanges = commitServerChanges;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/define-property\"));\n\nvar _defineProperties = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/define-properties\"));\n\nvar _getOwnPropertyDescriptors = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors\"));\n\nvar _forEach = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/for-each\"));\n\nvar _getOwnPropertyDescriptor = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor\"));\n\nvar _filter = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/filter\"));\n\nvar _getOwnPropertySymbols = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols\"));\n\nvar _keys = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/keys\"));\n\nvar _stringify = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/json/stringify\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/typeof\"));\n\nvar _defineProperty3 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/defineProperty\"));\n\nvar _includes = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/includes\"));\n\nvar _encode = _interopRequireDefault(require(\"./encode\"));\n\nvar _ParseFile = _interopRequireDefault(require(\"./ParseFile\"));\n\nvar _ParseObject = _interopRequireDefault(require(\"./ParseObject\"));\n\nvar _ParseRelation = _interopRequireDefault(require(\"./ParseRelation\"));\n\nvar _TaskQueue = _interopRequireDefault(require(\"./TaskQueue\"));\n\nvar _ParseOp = require(\"./ParseOp\");\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = (0, _keys.default)(object);\n\n  if (_getOwnPropertySymbols.default) {\n    var symbols = (0, _getOwnPropertySymbols.default)(object);\n    if (enumerableOnly) symbols = (0, _filter.default)(symbols).call(symbols, function (sym) {\n      return (0, _getOwnPropertyDescriptor.default)(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      var _context;\n\n      (0, _forEach.default)(_context = ownKeys(Object(source), true)).call(_context, function (key) {\n        (0, _defineProperty3.default)(target, key, source[key]);\n      });\n    } else if (_getOwnPropertyDescriptors.default) {\n      (0, _defineProperties.default)(target, (0, _getOwnPropertyDescriptors.default)(source));\n    } else {\n      var _context2;\n\n      (0, _forEach.default)(_context2 = ownKeys(Object(source))).call(_context2, function (key) {\n        (0, _defineProperty2.default)(target, key, (0, _getOwnPropertyDescriptor.default)(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction defaultState()\n/*: State*/\n{\n  return {\n    serverData: {},\n    pendingOps: [{}],\n    objectCache: {},\n    tasks: new _TaskQueue.default(),\n    existed: false\n  };\n}\n\nfunction setServerData(serverData\n/*: AttributeMap*/\n, attributes\n/*: AttributeMap*/\n) {\n  for (var _attr in attributes) {\n    if (typeof attributes[_attr] !== 'undefined') {\n      serverData[_attr] = attributes[_attr];\n    } else {\n      delete serverData[_attr];\n    }\n  }\n}\n\nfunction setPendingOp(pendingOps\n/*: Array<OpsMap>*/\n, attr\n/*: string*/\n, op\n/*: ?Op*/\n) {\n  var last = pendingOps.length - 1;\n\n  if (op) {\n    pendingOps[last][attr] = op;\n  } else {\n    delete pendingOps[last][attr];\n  }\n}\n\nfunction pushPendingState(pendingOps\n/*: Array<OpsMap>*/\n) {\n  pendingOps.push({});\n}\n\nfunction popPendingState(pendingOps\n/*: Array<OpsMap>*/\n)\n/*: OpsMap*/\n{\n  var first = pendingOps.shift();\n\n  if (!pendingOps.length) {\n    pendingOps[0] = {};\n  }\n\n  return first;\n}\n\nfunction mergeFirstPendingState(pendingOps\n/*: Array<OpsMap>*/\n) {\n  var first = popPendingState(pendingOps);\n  var next = pendingOps[0];\n\n  for (var _attr2 in first) {\n    if (next[_attr2] && first[_attr2]) {\n      var merged = next[_attr2].mergeWith(first[_attr2]);\n\n      if (merged) {\n        next[_attr2] = merged;\n      }\n    } else {\n      next[_attr2] = first[_attr2];\n    }\n  }\n}\n\nfunction estimateAttribute(serverData\n/*: AttributeMap*/\n, pendingOps\n/*: Array<OpsMap>*/\n, className\n/*: string*/\n, id\n/*: ?string*/\n, attr\n/*: string*/\n)\n/*: mixed*/\n{\n  var value = serverData[attr];\n\n  for (var i = 0; i < pendingOps.length; i++) {\n    if (pendingOps[i][attr]) {\n      if (pendingOps[i][attr] instanceof _ParseOp.RelationOp) {\n        if (id) {\n          value = pendingOps[i][attr].applyTo(value, {\n            className: className,\n            id: id\n          }, attr);\n        }\n      } else {\n        value = pendingOps[i][attr].applyTo(value);\n      }\n    }\n  }\n\n  return value;\n}\n\nfunction estimateAttributes(serverData\n/*: AttributeMap*/\n, pendingOps\n/*: Array<OpsMap>*/\n, className\n/*: string*/\n, id\n/*: ?string*/\n)\n/*: AttributeMap*/\n{\n  var data = {};\n\n  for (var attr in serverData) {\n    data[attr] = serverData[attr];\n  }\n\n  for (var i = 0; i < pendingOps.length; i++) {\n    for (attr in pendingOps[i]) {\n      if (pendingOps[i][attr] instanceof _ParseOp.RelationOp) {\n        if (id) {\n          data[attr] = pendingOps[i][attr].applyTo(data[attr], {\n            className: className,\n            id: id\n          }, attr);\n        }\n      } else {\n        if ((0, _includes.default)(attr).call(attr, '.')) {\n          // convert a.b.c into { a: { b: { c: value } } }\n          var fields = attr.split('.');\n          var first = fields[0];\n          var last = fields[fields.length - 1];\n          data[first] = _objectSpread({}, serverData[first]);\n\n          var object = _objectSpread({}, data);\n\n          for (var _i = 0; _i < fields.length - 1; _i++) {\n            object = object[fields[_i]];\n          }\n\n          object[last] = pendingOps[i][attr].applyTo(object[last]);\n        } else {\n          data[attr] = pendingOps[i][attr].applyTo(data[attr]);\n        }\n      }\n    }\n  }\n\n  return data;\n}\n\nfunction commitServerChanges(serverData\n/*: AttributeMap*/\n, objectCache\n/*: ObjectCache*/\n, changes\n/*: AttributeMap*/\n) {\n  for (var _attr3 in changes) {\n    var val = changes[_attr3];\n    serverData[_attr3] = val;\n\n    if (val && (0, _typeof2.default)(val) === 'object' && !(val instanceof _ParseObject.default) && !(val instanceof _ParseFile.default) && !(val instanceof _ParseRelation.default)) {\n      var json = (0, _encode.default)(val, false, true);\n      objectCache[_attr3] = (0, _stringify.default)(json);\n    }\n  }\n}","map":{"version":3,"sources":["/home/arsalan/Desktop/Front/Home/node_modules/parse/lib/browser/ObjectStateMutations.js"],"names":["_interopRequireDefault","require","_Object$defineProperty2","exports","value","defaultState","setServerData","setPendingOp","pushPendingState","popPendingState","mergeFirstPendingState","estimateAttribute","estimateAttributes","commitServerChanges","_defineProperty2","_defineProperties","_getOwnPropertyDescriptors","_forEach","_getOwnPropertyDescriptor","_filter","_getOwnPropertySymbols","_keys","_stringify","_typeof2","_defineProperty3","_includes","_encode","_ParseFile","_ParseObject","_ParseRelation","_TaskQueue","_ParseOp","ownKeys","object","enumerableOnly","keys","default","symbols","call","sym","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","_context","Object","key","_context2","serverData","pendingOps","objectCache","tasks","existed","attributes","_attr","attr","op","last","first","shift","next","_attr2","merged","mergeWith","className","id","RelationOp","applyTo","data","fields","split","_i","changes","_attr3","val","json"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs3/helpers/interopRequireDefault\");\n\nvar _Object$defineProperty2 = require(\"@babel/runtime-corejs3/core-js-stable/object/define-property\");\n\n_Object$defineProperty2(exports, \"__esModule\", {\n  value: true\n});\n\nexports.defaultState = defaultState;\nexports.setServerData = setServerData;\nexports.setPendingOp = setPendingOp;\nexports.pushPendingState = pushPendingState;\nexports.popPendingState = popPendingState;\nexports.mergeFirstPendingState = mergeFirstPendingState;\nexports.estimateAttribute = estimateAttribute;\nexports.estimateAttributes = estimateAttributes;\nexports.commitServerChanges = commitServerChanges;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/define-property\"));\n\nvar _defineProperties = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/define-properties\"));\n\nvar _getOwnPropertyDescriptors = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors\"));\n\nvar _forEach = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/for-each\"));\n\nvar _getOwnPropertyDescriptor = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor\"));\n\nvar _filter = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/filter\"));\n\nvar _getOwnPropertySymbols = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols\"));\n\nvar _keys = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/keys\"));\n\nvar _stringify = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/json/stringify\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/typeof\"));\n\nvar _defineProperty3 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/defineProperty\"));\n\nvar _includes = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/includes\"));\n\nvar _encode = _interopRequireDefault(require(\"./encode\"));\n\nvar _ParseFile = _interopRequireDefault(require(\"./ParseFile\"));\n\nvar _ParseObject = _interopRequireDefault(require(\"./ParseObject\"));\n\nvar _ParseRelation = _interopRequireDefault(require(\"./ParseRelation\"));\n\nvar _TaskQueue = _interopRequireDefault(require(\"./TaskQueue\"));\n\nvar _ParseOp = require(\"./ParseOp\");\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = (0, _keys.default)(object);\n\n  if (_getOwnPropertySymbols.default) {\n    var symbols = (0, _getOwnPropertySymbols.default)(object);\n    if (enumerableOnly) symbols = (0, _filter.default)(symbols).call(symbols, function (sym) {\n      return (0, _getOwnPropertyDescriptor.default)(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      var _context;\n\n      (0, _forEach.default)(_context = ownKeys(Object(source), true)).call(_context, function (key) {\n        (0, _defineProperty3.default)(target, key, source[key]);\n      });\n    } else if (_getOwnPropertyDescriptors.default) {\n      (0, _defineProperties.default)(target, (0, _getOwnPropertyDescriptors.default)(source));\n    } else {\n      var _context2;\n\n      (0, _forEach.default)(_context2 = ownKeys(Object(source))).call(_context2, function (key) {\n        (0, _defineProperty2.default)(target, key, (0, _getOwnPropertyDescriptor.default)(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction defaultState()\n/*: State*/\n{\n  return {\n    serverData: {},\n    pendingOps: [{}],\n    objectCache: {},\n    tasks: new _TaskQueue.default(),\n    existed: false\n  };\n}\n\nfunction setServerData(serverData\n/*: AttributeMap*/\n, attributes\n/*: AttributeMap*/\n) {\n  for (var _attr in attributes) {\n    if (typeof attributes[_attr] !== 'undefined') {\n      serverData[_attr] = attributes[_attr];\n    } else {\n      delete serverData[_attr];\n    }\n  }\n}\n\nfunction setPendingOp(pendingOps\n/*: Array<OpsMap>*/\n, attr\n/*: string*/\n, op\n/*: ?Op*/\n) {\n  var last = pendingOps.length - 1;\n\n  if (op) {\n    pendingOps[last][attr] = op;\n  } else {\n    delete pendingOps[last][attr];\n  }\n}\n\nfunction pushPendingState(pendingOps\n/*: Array<OpsMap>*/\n) {\n  pendingOps.push({});\n}\n\nfunction popPendingState(pendingOps\n/*: Array<OpsMap>*/\n)\n/*: OpsMap*/\n{\n  var first = pendingOps.shift();\n\n  if (!pendingOps.length) {\n    pendingOps[0] = {};\n  }\n\n  return first;\n}\n\nfunction mergeFirstPendingState(pendingOps\n/*: Array<OpsMap>*/\n) {\n  var first = popPendingState(pendingOps);\n  var next = pendingOps[0];\n\n  for (var _attr2 in first) {\n    if (next[_attr2] && first[_attr2]) {\n      var merged = next[_attr2].mergeWith(first[_attr2]);\n\n      if (merged) {\n        next[_attr2] = merged;\n      }\n    } else {\n      next[_attr2] = first[_attr2];\n    }\n  }\n}\n\nfunction estimateAttribute(serverData\n/*: AttributeMap*/\n, pendingOps\n/*: Array<OpsMap>*/\n, className\n/*: string*/\n, id\n/*: ?string*/\n, attr\n/*: string*/\n)\n/*: mixed*/\n{\n  var value = serverData[attr];\n\n  for (var i = 0; i < pendingOps.length; i++) {\n    if (pendingOps[i][attr]) {\n      if (pendingOps[i][attr] instanceof _ParseOp.RelationOp) {\n        if (id) {\n          value = pendingOps[i][attr].applyTo(value, {\n            className: className,\n            id: id\n          }, attr);\n        }\n      } else {\n        value = pendingOps[i][attr].applyTo(value);\n      }\n    }\n  }\n\n  return value;\n}\n\nfunction estimateAttributes(serverData\n/*: AttributeMap*/\n, pendingOps\n/*: Array<OpsMap>*/\n, className\n/*: string*/\n, id\n/*: ?string*/\n)\n/*: AttributeMap*/\n{\n  var data = {};\n\n  for (var attr in serverData) {\n    data[attr] = serverData[attr];\n  }\n\n  for (var i = 0; i < pendingOps.length; i++) {\n    for (attr in pendingOps[i]) {\n      if (pendingOps[i][attr] instanceof _ParseOp.RelationOp) {\n        if (id) {\n          data[attr] = pendingOps[i][attr].applyTo(data[attr], {\n            className: className,\n            id: id\n          }, attr);\n        }\n      } else {\n        if ((0, _includes.default)(attr).call(attr, '.')) {\n          // convert a.b.c into { a: { b: { c: value } } }\n          var fields = attr.split('.');\n          var first = fields[0];\n          var last = fields[fields.length - 1];\n          data[first] = _objectSpread({}, serverData[first]);\n\n          var object = _objectSpread({}, data);\n\n          for (var _i = 0; _i < fields.length - 1; _i++) {\n            object = object[fields[_i]];\n          }\n\n          object[last] = pendingOps[i][attr].applyTo(object[last]);\n        } else {\n          data[attr] = pendingOps[i][attr].applyTo(data[attr]);\n        }\n      }\n    }\n  }\n\n  return data;\n}\n\nfunction commitServerChanges(serverData\n/*: AttributeMap*/\n, objectCache\n/*: ObjectCache*/\n, changes\n/*: AttributeMap*/\n) {\n  for (var _attr3 in changes) {\n    var val = changes[_attr3];\n    serverData[_attr3] = val;\n\n    if (val && (0, _typeof2.default)(val) === 'object' && !(val instanceof _ParseObject.default) && !(val instanceof _ParseFile.default) && !(val instanceof _ParseRelation.default)) {\n      var json = (0, _encode.default)(val, false, true);\n      objectCache[_attr3] = (0, _stringify.default)(json);\n    }\n  }\n}"]},"metadata":{},"sourceType":"script"}